# 会話→メール送信 動作例デモ

## 🎬 使用例1: 営業レポート送信

### ユーザー操作
```
LINE入力: "高見さんの7月のレポートをまとめて、それを高見さんに送信して"
```

### システム動作フロー
```
1. 質問分類: sales_query
2. RAGサービス: 高見さんの7月実績データ取得
3. AI回答生成:
   """
   📊 高見さんの7月度実績レポート
   
   ・粗利目標: 1,820万円
   ・粗利実績: 1,825万円  
   ・達成率: 100.3%
   ・訪問件数: 19件
   ・商談件数: 8件
   ・成約見込: 3件
   
   堺市立三国丘小学校、北池田中学校への訪問を実施。
   XEROX製品2件、RISO製品2件の提案が進行中です。
   """

4. メール送信サービス判定: 
   - "送信して" → メール送信必要
   - "高見さん" → 宛先: takami@hbm-web.co.jp
   
5. N8N Webhook送信:
   {
     "action": "send_email",
     "email_data": {
       "recipients": [{"email": "takami@hbm-web.co.jp", "name": "高見"}],
       "subject": "【阪南ビジネスマシン】7月度営業レポート",
       "content": "上記のレポート内容",
       "urgency": "normal"
     }
   }

6. Gmail送信実行
7. 最終応答:
   """
   📊 高見さんの7月度実績レポート
   （省略）
   
   ---
   
   📧 メール送信完了
   
   ✅ メール送信処理を開始しました
   
   宛先: 高見
   件名: 【阪南ビジネスマシン】7月度営業レポート
   緊急度: normal
   
   メールの配信完了まで少々お時間をいただく場合があります。
   """
```

## 🎬 使用例2: 顧客サポート対応

### ユーザー操作
```
LINE入力: "お客さんからコピー機MX-2661のトナーの変更方法教えてと連絡が来てます。調べてcustomer@maa.co.jpにその旨送って欲しい"
```

### システム動作フロー
```
1. 質問分類: unknown (DBにない) → Web検索実行
2. Web検索: "MX-2661 トナー 変更方法"
3. 検索結果:
   """
   🔍 Web検索結果
   
   Sharp MX-2661のトナー交換方法：
   
   1. 前面カバーを開く
   2. 使用済みトナーカートリッジを取り出す
   3. 新しいトナーカートリッジを5-6回振る
   4. 保護テープを剥がす
   5. カートリッジを所定位置にセット
   6. 前面カバーを閉じる
   7. テスト印刷で確認
   
   注意事項：
   - 純正トナーの使用を推奨
   - 交換時は手袋着用
   - 使用済みトナーは適切に廃棄
   """

4. メール送信サービス判定:
   - "送って" → メール送信必要
   - "customer@maa.co.jp" → 直接メールアドレス指定
   
5. N8N Webhook送信:
   {
     "action": "send_email", 
     "email_data": {
       "recipients": [{"email": "customer@maa.co.jp", "name": "顧客"}],
       "subject": "【阪南ビジネスマシン】コピー機トナー交換方法のご案内",
       "content": "上記の検索結果 + 丁寧な案内文",
       "urgency": "normal"
     }
   }

6. Gmail送信実行
7. 最終応答:
   """
   🔍 Web検索結果
   （トナー交換手順）
   
   ---
   
   📧 メール送信完了
   
   ✅ メール送信処理を開始しました
   
   宛先: 顧客
   件名: 【阪南ビジネスマシン】コピー機トナー交換方法のご案内
   緊急度: normal
   
   お客様への回答を送信いたしました。
   """
```

## 🎬 使用例3: 複数宛先・緊急メール

### ユーザー操作
```
LINE入力: "緊急：今月の売上実績が目標を下回りそうです。部長と課長に至急報告してください"
```

### システム動作フロー
```
1. 質問分類: sales_query
2. RAGサービス: 今月の売上実績データ取得
3. AI回答生成: 売上実績と分析内容
4. メール送信サービス判定:
   - "緊急" "至急" → urgency: "urgent"
   - "部長と課長" → 複数宛先
   
5. N8N Webhook送信:
   {
     "action": "send_email",
     "email_data": {
       "recipients": [
         {"email": "bucho@hbm-web.co.jp", "name": "部長"},
         {"email": "kacho@hbm-web.co.jp", "name": "課長"}
       ],
       "subject": "【阪南ビジネスマシン】売上実績について",
       "content": "売上実績レポート内容",
       "urgency": "urgent"
     }
   }

6. Gmail送信実行（件名に【緊急】追加）
7. 最終応答に緊急度を反映
```

## 🧪 テスト用コマンド例

### 直接API呼び出しテスト
```bash
# システム側テスト
curl -X POST http://localhost:8000/test-email \
  -H "Content-Type: application/json" \
  -d '{
    "user_message": "高見さんの7月レポートを高見さんに送信して",
    "ai_response": "7月度実績: 目標1820万円、実績1825万円、達成率100.3%"
  }'

# N8N側テスト  
curl -X POST http://localhost:5678/webhook/hannan-email-send \
  -H "Content-Type: application/json" \
  -d '{
    "action": "send_email",
    "email_data": {
      "recipients": [{"email": "test@example.com", "name": "テスト"}],
      "subject": "【阪南ビジネスマシン】テストメール", 
      "content": "これはシステムテストです。",
      "urgency": "normal"
    }
  }'
```

## 📊 期待される効果

### ✅ 自動化されるタスク
- 営業レポートの定期配信
- 顧客問い合わせへの即座回答
- 緊急事態の迅速な情報共有
- 社内コミュニケーションの効率化

### 📈 生産性向上
- 手動メール作成時間: 5-10分 → 自動化: 30秒
- 情報共有の遅延: 数時間 → リアルタイム
- レポート配信の手間: 毎回手作業 → 完全自動

### 💡 ビジネス価値
- 営業効率の向上
- 顧客満足度の向上  
- 情報共有の迅速化
- 業務プロセスのデジタル化
